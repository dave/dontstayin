Type.registerNamespace('SpottedScript.Controls.EventCreator');
SpottedScript.Controls.EventCreator.Controller=function(view){if(SpottedScript.Controls.EventCreator.Controller.instance==null){SpottedScript.Controls.EventCreator.Controller.instance=this;this.$0=view;}this.oldOnFocus=this.$0.get_uiEventName().onFocus;this.$0.get_uiEventName().onFocus=Function.createDelegate(this,this.$B);this.$2=this.$0.get_uiEventName().transformReceivedSuggestions;this.$0.get_uiEventName().transformReceivedSuggestions=Function.createDelegate(this,this.$A);this.$3=this.$0.get_uiEventName().itemChosen;this.$0.get_uiEventName().itemChosen=Function.createDelegate(this,this.$7);view.get_uiEventName().parameters.set('returnInfo',true);$addHandler(view.get_uiContainer(),'keydown',Function.createDelegate(this,this.$6));$addHandler(view.get_uiAdd(),'click',Function.createDelegate(this,this.$5));SpottedScript.Misc.addHoverText(view.get_uiSummary(),'click to select an event');}
SpottedScript.Controls.EventCreator.Controller.prototype={$0:null,$1:null,oldOnFocus:null,$2:null,$3:null,$4:null,$5:function($p0){var $0=[];if(this.$0.get_uiBrand().get_value().length>0){$0[0]=Number.parseInvariant(this.$0.get_uiBrand().get_value());}Spotted.WebServices.Controls.EventCreator.Service.addEvent(this.$0.get_uiCal().getDate(),this.$0.get_uiVenueGetter().$4().k,this.$0.get_uiEventName().get_text(),this.$0.get_uiSummary().value,$0,Function.createDelegate(this,this.$9),Function.createDelegate(null,Utils.Trace.webServiceFailure),null,5000);$p0.preventDefault();},$6:function($p0){if($p0.keyCode===27){this.$8(null);}},$7:function($p0){if($p0.value==='{addMethod:quick}'){jQuery(this.$0.get_uiAddOptionsPanel()).slideDown(Function.createDelegate(this,function(){
this.$0.get_uiSummary().focus();}));this.$0.get_uiEventName().set_text($p0.key);}else if($p0.value==='{filloutFields}'){if(this.$0.get_uiCal().getDate()==null){this.$0.get_uiCal().$3();}else{this.$0.get_uiVenueGetter().$7();}this.$0.get_uiEventName().set_text('');this.$0.get_uiEventName().set_value('');}else{this.$8(Sys.Serialization.JavaScriptSerializer.deserialize($p0.value));}},$8:function($p0){this.$0.get_uiContainer().style.display='none';this.$1($p0);},$9:function($p0,$p1,$p2){this.$8($p0);},$A:function($p0,$p1){if(this.$0.get_uiVenueGetter().$4()!=null&&this.$0.get_uiCal().getDate()!=null&&this.$0.get_uiEventName().get_value()===''){var $0=this.$0.get_uiEventName().get_text()+' @ '+this.$0.get_uiVenueGetter().$4().name+' on '+this.$0.get_uiCal().getDate().format('ddd dd/MM/yyyy');var $1=new ScriptSharpLibrary.Suggestion();$1.html=ScriptSharpLibrary.Suggestion.getPicTitleDetailTemplateHtml('@/gfx/icon40-eventcreator-add.png','Add <b>'+$0+'</b>','You\'ll be able to add more details later if you like');$1.value='{addMethod:quick}';$1.text=this.$0.get_uiEventName().get_text();ScriptSharpLibrary.Suggestion.addSuggestion($p0,$1,$p1);}else{var $2=new ScriptSharpLibrary.Suggestion();$2.html=ScriptSharpLibrary.Suggestion.getPicTitleDetailTemplateHtml('/gfx/icon40-eventcreator-noadd.png','Can\'t add <b>'+this.$0.get_uiEventName().get_text()+'</b>','Fill out all the fields');$2.value='{filloutFields}';$2.text=this.$0.get_uiEventName().get_text();ScriptSharpLibrary.Suggestion.addSuggestion($p0,$2,$p1);}if(this.$2!=null){$p0=this.$2($p0,$p1);}return $p0;},$B:function($p0){if(this.$0.get_uiCal().getDate()!=null){this.$0.get_uiEventName().parameters.set('date',this.$0.get_uiCal().getDate());}else{this.$0.get_uiEventName().parameters.set('date',null);}var $0=this.$0.get_uiVenueGetter().$4();if($0==null){this.$0.get_uiEventName().parameters.set('venueK',null);}else{this.$0.get_uiEventName().parameters.set('venueK',this.$0.get_uiVenueGetter().$4().k);}if(this.oldOnFocus!=null){this.oldOnFocus($p0);}},createEventUsingEventInfo:function(eventInfo,callback){if(eventInfo==null){this.showPopup(null,null,null,callback);}else{this.showPopup(eventInfo.date,eventInfo.venueInfo,eventInfo.name,callback);}},showPopup:function(date,info,text,callback){this.$0.get_uiContainer().style.display='';this.$1=callback;this.$0.get_uiEventName().set_text((text!=null)?text:'');this.$0.get_uiEventName().focus();if(info!=null){this.$0.get_uiVenueGetter().setVenue(info);}else{this.$0.get_uiVenueGetter().$7();}if(date!=null){this.$0.get_uiCal().setDate(date);}else{this.$0.get_uiCal().$3();}if(date!=null&&info!=null&&callback!=null){this.$0.get_uiEventName().requestSuggestions();}}}
SpottedScript.Controls.EventCreator.EventInfo=function(){}
SpottedScript.Controls.EventCreator.EventInfo.eventFullName=function(ei){return ei.name+' on '+ei.date.format('ddd dd/MM/yyyy')+' @ '+SpottedScript.Controls.VenueCreator.VenueInfo.nameWithPlace(ei.venueInfo);}
SpottedScript.Controls.EventCreator.EventInfo.prototype={name:null,k:0,date:null,venueInfo:null,url:null,picPath:null}
SpottedScript.Controls.EventCreator.View=function(clientId){this.clientId=clientId;}
SpottedScript.Controls.EventCreator.View.prototype={clientId:null,get_uiContainer:function(){return document.getElementById(this.clientId+'_uiContainer');},get_h1:function(){return document.getElementById(this.clientId+'_H1');},get_uiCal:function(){return eval(this.clientId+'_uiCalController');},get_uiVenueGetter:function(){return eval(this.clientId+'_uiVenueGetterController');},get_uiEventName:function(){return eval(this.clientId+'_uiEventNameBehaviour');},get_uiAddOptionsPanel:function(){return document.getElementById(this.clientId+'_uiAddOptionsPanel');},get_uiSummary:function(){return document.getElementById(this.clientId+'_uiSummary');},get_uiBrand:function(){return eval(this.clientId+'_uiBrandBehaviour');},get_uiAdd:function(){return document.getElementById(this.clientId+'_uiAdd');}}
SpottedScript.Controls.EventCreator.Controller.registerClass('SpottedScript.Controls.EventCreator.Controller');
SpottedScript.Controls.EventCreator.EventInfo.registerClass('SpottedScript.Controls.EventCreator.EventInfo');
SpottedScript.Controls.EventCreator.View.registerClass('SpottedScript.Controls.EventCreator.View');
SpottedScript.Controls.EventCreator.Controller.instance=null;
