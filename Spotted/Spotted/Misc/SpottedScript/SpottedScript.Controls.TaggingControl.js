Type.registerNamespace('SpottedScript.Controls.TaggingControl');
SpottedScript.Controls.TaggingControl.Controller=function(view){this.$0=view;this.$3={};if(view.get_uiAddTagButton()!=null){$addHandler(view.get_uiAddTagButton(),'click',Function.createDelegate(this,this.$4));view.get_uiTagAutoSuggest().itemChosen=Function.createDelegate(this,this.$5);}}
SpottedScript.Controls.TaggingControl.Controller.prototype={$0:null,$1:0,get_$2:function(){return this.$1;},set_$2:function($p0){this.$1=$p0;this.$A();return $p0;},$3:null,$4:function($p0){$p0.preventDefault();this.$6(this.$0.get_uiTagAutoSuggest().get_text());this.$0.get_uiTagAutoSuggest().set_text('');},$5:function($p0){this.$6($p0.value);this.$0.get_uiTagAutoSuggest().set_text('');},$6:function($p0){Spotted.WebServices.Controls.TaggingControl.Service.addTagToPhoto($p0,this.$1,Function.createDelegate(this,this.$7),Function.createDelegate(null,Utils.Trace.webServiceFailure),null,-1);},$7:function($p0,$p1,$p2){if($p0!=null){(this.$3[this.get_$2().toString()])[$p0.k.toString()]=$p0;this.$A();}},$8:function($p0){var $0=this.$B($p0);if($0.length>0){Spotted.WebServices.Controls.TaggingControl.Service.getTagsForPhotoKs($0,Function.createDelegate(this,this.$9),Function.createDelegate(null,Utils.Trace.webServiceFailure),null,-1);}else{this.$A();}},$9:function($p0,$p1,$p2){var $dict1=$p0;for(var $key2 in $dict1){var $0={key:$key2,value:$dict1[$key2]};this.$3[$0.key]=$0.value;}this.$A();},$A:function(){this.$C(this.$3[this.get_$2().toString()]);},$B:function($p0){var $0=[];var $1=0;for(var $2=0;$2<$p0.length;$2++){var $3=false;var $dict1=this.$3;for(var $key2 in $dict1){var $4={key:$key2,value:$dict1[$key2]};if($4.key===$p0[$2].toString()){$3=true;break;}}if(!$3){$0[$1]=$p0[$2];$1++;}}return $0;},$C:function($p0){this.$0.get_uiTagsDiv().style.display='none';this.$0.get_uiTagsDivServerSide().style.display='none';if($p0!=null){this.$0.get_uiTagsDiv().innerHTML='';var $dict1=$p0;for(var $key2 in $dict1){var $0={key:$key2,value:$dict1[$key2]};this.$0.get_uiTagsDiv().style.display='';this.$D($0.value);}}},$D:function($p0){this.$0.get_uiTagsDiv().appendChild(this.$10($p0));},$E:function($p0){if(confirm('Are you sure you want to remove the tag \"'+($p0.target).getAttribute('tagText').toString()+'\" from this photo?')){var $0=$p0.target.getAttribute('tagK');Spotted.WebServices.Controls.TaggingControl.Service.removeTagFromPhoto($0,this.$1,Function.createDelegate(this,this.$F),Function.createDelegate(null,Utils.Trace.webServiceFailure),$0,-1);}},$F:function($p0,$p1,$p2){delete (this.$3[this.$1.toString()])[$p1.toString()];this.$A();},$10:function($p0){var $0=document.createElement('span');var $1=document.createElement('a');$1.innerHTML=$p0.tagText;$1.href='/tags/'+$p0.tagText;$1.style.paddingLeft='3px';$1.style.paddingRight='3px';$0.appendChild($1);var $2=document.createElement('img');$2.src='/gfx/minus.gif';$2.alt='X';$2.title='Remove this tag';$2.className='RemoveTagButton';$2.style.borderWidth='0px';$2.style.cursor='hand';$2.setAttribute('tagText',$p0.tagText);$2.setAttribute('tagK',$p0.k);$0.appendChild($2);$addHandler($2,'click',Function.createDelegate(this,this.$E));return $0;}}
SpottedScript.Controls.TaggingControl.TagStub=function(){}
SpottedScript.Controls.TaggingControl.TagStub.prototype={k:0,photoK:0,tagText:null}
SpottedScript.Controls.TaggingControl.View=function(clientId){this.clientId=clientId;}
SpottedScript.Controls.TaggingControl.View.prototype={clientId:null,get_uiTagPanel:function(){return document.getElementById(this.clientId+'_uiTagPanel');},get_uiTagsDiv:function(){return document.getElementById(this.clientId+'_uiTagsDiv');},get_uiTagsDivServerSide:function(){return document.getElementById(this.clientId+'_uiTagsDivServerSide');},get_uiTagRepeater:function(){return document.getElementById(this.clientId+'_uiTagRepeater');},get_uiAddPanel:function(){return document.getElementById(this.clientId+'_uiAddPanel');},get_uiTagAutoSuggest:function(){return eval(this.clientId+'_uiTagAutoSuggestBehaviour');},get_uiAddTagButton:function(){return document.getElementById(this.clientId+'_uiAddTagButton');}}
SpottedScript.Controls.TaggingControl.Controller.registerClass('SpottedScript.Controls.TaggingControl.Controller');
SpottedScript.Controls.TaggingControl.TagStub.registerClass('SpottedScript.Controls.TaggingControl.TagStub');
SpottedScript.Controls.TaggingControl.View.registerClass('SpottedScript.Controls.TaggingControl.View');
